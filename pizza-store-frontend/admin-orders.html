<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin - All Orders</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        body { margin: 0; display: flex; height: 100vh; background-color: #f4f6f8; }

        /* SIDEBAR (Same as Dashboard) */
        .sidebar { width: 250px; background-color: #2c3e50; color: white; padding: 20px; display: flex; flex-direction: column; }
        .sidebar h2 { margin-top: 0; font-size: 22px; border-bottom: 1px solid #34495e; padding-bottom: 15px; }
        .sidebar a { color: #ecf0f1; text-decoration: none; padding: 12px; margin-bottom: 5px; border-radius: 4px; display: block; }
        .sidebar a:hover, .sidebar a.active { background-color: #34495e; }
        .logout-btn { margin-top: auto; background-color: #c0392b; text-align: center; }

        /* MAIN CONTENT */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }

        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        /* TABLE */
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        th { background-color: #ecf0f1; color: #2c3e50; text-align: left; padding: 15px; font-weight: 600; }
        td { padding: 15px; border-bottom: 1px solid #ecf0f1; color: #555; vertical-align: middle; }
        
        /* STATUS BADGES */
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .badge-Placed { background-color: #f1c40f; color: #fff; }
        .badge-Cancelled { background-color: #e74c3c; color: #fff; }
        .badge-Paid { background-color: #27ae60; color: #fff; } /* We will check payment status too */
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Admin Panel</h2>
        <a href="admin-dashboard.html">üçï Menu Management</a>
        <a href="#" class="active">üì¶ Orders (View Only)</a>
        <a href="index.html" class="logout-btn">Logout</a>
    </div>

    <div class="main-content">
        <div class="page-header">
            <h3>üì¶ All Customer Orders</h3>
            <button onclick="loadOrders()" style="background:#3498db; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">Refresh List</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Date</th>
                    <th>Customer Email</th>
                    <th>Pizza Item</th>
                    <th>Amount</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="ordersTableBody">
                <tr><td colspan="6">Loading...</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        const GATEWAY_URL = "http://localhost:8080"; 
        const ORDER_API = `${GATEWAY_URL}/order`;

        window.onload = loadOrders;

        async function loadOrders() {
            try {
                // Fetch ALL orders
                const response = await fetch(`${ORDER_API}/all`);
                
                if (!response.ok) throw new Error("Failed to fetch");
                
                const orders = await response.json();
                renderTable(orders);
            } catch (error) {
                console.error("Error:", error);
                document.getElementById("ordersTableBody").innerHTML = "<tr><td colspan='6' style='color:red'>Failed to load orders. Check Backend.</td></tr>";
            }
        }

        function renderTable(data) {
            const tableBody = document.getElementById("ordersTableBody");
            tableBody.innerHTML = "";
            
            if(data.length === 0) {
                tableBody.innerHTML = "<tr><td colspan='6'>No orders found in database.</td></tr>";
                return;
            }

            // Sort by newest first (optional)
            data.reverse(); 

            data.forEach(order => {
                // Simple date formatting
                const date = order.orderDate ? new Date(order.orderDate).toLocaleDateString() : "N/A";
                
                const row = `<tr>
                    <td>#${order.orderId}</td>
                    <td>${date}</td>
                    <td>${order.userEmail}</td>
                    <td><strong>${order.pizzaName}</strong> <span style="color:#7f8c8d; font-size:12px">(${order.size || 'Reg'})</span></td>
                    <td>‚Çπ${order.price}</td>
                    <td><span class="badge badge-${order.status}">${order.status}</span></td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }
    </script>
</body>
</html>